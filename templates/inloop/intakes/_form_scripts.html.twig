
<script >
    window.onload = function() {
        if ($) {

            $(function () {
                var toegang = function (name) {

                    var check = function () {
                        var status = $("#" + name + "_toegang_verblijfsstatus").find(":selected").first().text()
                        var intakelocatie = $("#" + name + "_toegang_intakelocatie").find(":selected").first().text()
                        var accessStrategies = {{ accessStrategies|raw }};
                        var toegang_intakelocatieElm = $("#" + name + "_toegang_toegangIntakelocatie");

                        const statuses = ["{{ verblijfsstatus_europees_burger }}", "{{ verblijfsstatus_illegaal }}"];
                        if (statuses.includes(status)) {
                            // $("#" + name + "_toegang_overigenToegangVan").prop("disabled", false);
                            var sixMonths = new Date();
                            var m = sixMonths.getMonth();
                            sixMonths.setMonth(m + 4);
                            var options = {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit',
                            }
                            if ($("#" + name + "_toegang_overigenToegangVan").val() == "") {
                                $("#" + name + "_toegang_overigenToegangVan").val(sixMonths.toLocaleDateString('nl-NL',options));

                            }
                            $("#" + name + "_toegang_overigenToegangVan").prop("readonly",false);
                        } else {
                            $("#" + name + "_toegang_overigenToegangVan").val(null);
                            $("#" + name + "_toegang_overigenToegangVan").prop("readonly","readonly");
                        }
                    }//end check()

                    var verblijfsstatusElm = $("#" + name + "_toegang_verblijfsstatus");
                    var intakelocatieElm = $("#" + name + "_toegang_intakelocatie");

                    verblijfsstatusElm.on('change', function () {
                        check();
                    });

                    intakelocatieElm.on('change',function(){ check(); } );


                    check(); // init.
                };

                toegang($("form").first().attr("name"));
            });


            {% if tbc_countries is defined %}
            $(function () {

                var tbc_countries = [];
                {% for country in tbc_countries %}
                tbc_countries.push("{{ country }}");
                {% endfor %}

                var checkTbc = function (tbc_countries, selectedCountry, laatsteTbcControle) {
                    if (jQuery.inArray(selectedCountry, tbc_countries) !== -1) {
                        if (laatsteTbcControle == "") {
                            alert("Klant uit risicoland voor TBC besmetting. Naar GGD sturen voor TBC controle.");
                        }
                        $('#klant_laatsteTbcControle').removeClass("hidden");
                        $("label[for='klant_laatsteTbcControle']").removeClass("hidden");

                    } else {
                        $('#klant_laatsteTbcControle').addClass("hidden");
                        $("label[for='klant_laatsteTbcControle']").addClass("hidden");

                    }
                    // console.log(event.data.tbc_countries,$(this).find("option:selected").text());
                };


                checkTbc(tbc_countries, "{{ entity.klant.getLand().getNaam() }}", "{{ entity.klant.getLaatsteTbcControle()|date("m-d-Y") }}");
            });
        } //end if($)
    }//end window.onload
    {% endif %}
</script>
