CKEDITOR.dialog.add("cellProperties",(function(t){function e(t){return{isSpacer:!0,type:"html",html:"&nbsp;",requiredContent:t||void 0}}function o(e){return{requiredContent:"td{"+e+"}",type:"hbox",widths:["70%","30%"],children:[{type:"text",id:e,width:"100px",label:s[e],validate:d.number(u["invalid"+CKEDITOR.tools.capitalize(e)]),onLoad:function(){var t=this.getDialog().getContentElement("info",e+"Type").getElement(),o=this.getInputElement(),i=o.getAttribute("aria-labelledby");o.setAttribute("aria-labelledby",[i,t.$.id].join(" "))},setup:i((function(t){var o=parseFloat(t.getAttribute(e),10);return t=parseFloat(t.getStyle(e),10),isNaN(t)?isNaN(o)?void 0:o:t})),commit:function(t){var o=parseFloat(this.getValue(),10),i=this.getDialog().getValueOf("info",e+"Type")||n(t,e);isNaN(o)?t.removeStyle(e):t.setStyle(e,o+i),t.removeAttribute(e)},default:""},{type:"select",id:e+"Type",label:t.lang.table[e+"Unit"],labelStyle:"visibility:hidden;display:block;width:0;overflow:hidden",default:"px",items:[[c.widthPx,"px"],[c.widthPc,"%"]],setup:i((function(t){return n(t,e)}))}]}}function i(t){return function(e){for(var o=t(e[0]),i=1;i<e.length;i++)if(t(e[i])!==o){o=null;break}void 0!==o&&(this.setValue(o),CKEDITOR.env.gecko&&"select"==this.type&&!o&&(this.getInputElement().$.selectedIndex=-1))}}function n(t,e){var o=/^(\d+(?:\.\d+)?)(px|%)$/.exec(t.getStyle(e)||t.getAttribute(e));if(o)return o[2]}function r(e,o){t.getColorFromDialog((function(t){t&&e.getDialog().getContentElement("info",o).setValue(t),e.focus()}),e)}function l(t,e,o){(t=t.getValue())?e.setStyle(o,t):e.removeStyle(o),"background-color"==o?e.removeAttribute("bgColor"):"border-color"==o&&e.removeAttribute("borderColor")}var a,c=t.lang.table,u=c.cell,s=t.lang.common,d=CKEDITOR.dialog.validate,g="rtl"==t.lang.dir,p=t.plugins.colordialog,h=o("width"),b=o("height"),f=e(["td{width}","td{height}"]),m={type:"select",id:"wordWrap",requiredContent:"td{white-space}",label:u.wordWrap,default:"yes",items:[[u.yes,"yes"],[u.no,"no"]],setup:i((function(t){var e=t.getAttribute("noWrap");if("nowrap"==t.getStyle("white-space")||e)return"no"})),commit:function(t){"no"==this.getValue()?t.setStyle("white-space","nowrap"):t.removeStyle("white-space"),t.removeAttribute("noWrap")}},v=e("td{white-space}"),y={type:"select",id:"hAlign",requiredContent:"td{text-align}",label:u.hAlign,default:"",items:[[s.notSet,""],[s.left,"left"],[s.center,"center"],[s.right,"right"],[s.justify,"justify"]],setup:i((function(t){var e=t.getAttribute("align");return t.getStyle("text-align")||e||""})),commit:function(t){var e=this.getValue();e?t.setStyle("text-align",e):t.removeStyle("text-align"),t.removeAttribute("align")}},C={type:"select",id:"vAlign",requiredContent:"td{vertical-align}",label:u.vAlign,default:"",items:[[s.notSet,""],[s.alignTop,"top"],[s.alignMiddle,"middle"],[s.alignBottom,"bottom"],[u.alignBaseline,"baseline"]],setup:i((function(t){var e=t.getAttribute("vAlign");switch(t=t.getStyle("vertical-align")){case"top":case"middle":case"bottom":case"baseline":break;default:t=""}return t||e||""})),commit:function(t){var e=this.getValue();e?t.setStyle("vertical-align",e):t.removeStyle("vertical-align"),t.removeAttribute("vAlign")}},S=(h=[h,b,f,m,v,y,C,e(["td{text-align}","td{vertical-align}"]),{type:"select",id:"cellType",requiredContent:"th[scope]",label:u.cellType,default:"td",items:t.config.tabletools_scopedHeaders?[[u.data,"td"],[u.columnHeader,"thc"],[u.rowHeader,"thr"]]:[[u.data,"td"],[u.header,"th"]],setup:i((function(t){var e=t.getName();if(t=t.getAttribute("scope"),"td"===e)return"td";switch(t){case"row":return"thr";case"col":return"thc";default:return"th"}})),commit:function(t){var e={td:{name:"td"},th:{name:"th"},thc:{name:"th",scope:"col"},thr:{name:"th",scope:"row"}}[this.getValue()];t.renameNode(e.name),e.scope?t.setAttribute("scope",e.scope):t.removeAttribute("scope")}},e("th"),{type:"text",id:"rowSpan",requiredContent:"td[rowspan]",label:u.rowSpan,default:"",validate:d.integer(u.invalidRowSpan),setup:i((function(t){if((t=parseInt(t.getAttribute("rowSpan"),10))&&1!=t)return t})),commit:function(t){var e=parseInt(this.getValue(),10);e&&1!=e?t.setAttribute("rowSpan",this.getValue()):t.removeAttribute("rowSpan")}},{type:"text",id:"colSpan",requiredContent:"td[colspan]",label:u.colSpan,default:"",validate:d.integer(u.invalidColSpan),setup:i((function(t){if((t=parseInt(t.getAttribute("colSpan"),10))&&1!=t)return t})),commit:function(t){var e=parseInt(this.getValue(),10);e&&1!=e?t.setAttribute("colSpan",this.getValue()):t.removeAttribute("colSpan")}},e(["td[colspan]","td[rowspan]"]),{type:"hbox",padding:0,widths:p?["60%","40%"]:["100%"],requiredContent:"td{background-color}",children:(a=[{type:"text",id:"bgColor",label:u.bgColor,default:"",setup:i((function(t){var e=t.getAttribute("bgColor");return t.getStyle("background-color")||e})),commit:function(t){l(this,t,"background-color")}}],p&&a.push({type:"button",id:"bgColorChoose",class:"colorChooser",label:u.chooseColor,onLoad:function(){this.getElement().getParent().setStyle("vertical-align","bottom")},onClick:function(){r(this,"bgColor")}}),a)},{type:"hbox",padding:0,widths:p?["60%","40%"]:["100%"],requiredContent:"td{border-color}",children:function(){var t=[{type:"text",id:"borderColor",label:u.borderColor,default:"",setup:i((function(t){var e=t.getAttribute("borderColor");return t.getStyle("border-color")||e})),commit:function(t){l(this,t,"border-color")}}];return p&&t.push({type:"button",id:"borderColorChoose",class:"colorChooser",label:u.chooseColor,style:(g?"margin-right":"margin-left")+": 10px",onLoad:function(){this.getElement().getParent().setStyle("vertical-align","bottom")},onClick:function(){r(this,"borderColor")}}),t}()}],0),w=-1,A=[{type:"vbox",padding:0,children:[]}];h=CKEDITOR.tools.array.filter(h,(function(e){var o=e.requiredContent;return delete e.requiredContent,(o=t.filter.check(o))&&!e.isSpacer&&S++,o}));return 5<S&&(A=A.concat([e(),{type:"vbox",padding:0,children:[]}])),CKEDITOR.tools.array.forEach(h,(function(t){t.isSpacer||w++,5<S&&w>=S/2?A[2].children.push(t):A[0].children.push(t)})),CKEDITOR.tools.array.forEach(A,(function(t){t.isSpacer||(t=t.children)[t.length-1].isSpacer&&t.pop()})),{title:u.title,minWidth:1===A.length?205:410,minHeight:50,contents:[{id:"info",label:u.title,accessKey:"I",elements:[{type:"hbox",widths:1===A.length?["100%"]:["40%","5%","40%"],children:A}]}],getModel:function(t){return CKEDITOR.plugins.tabletools.getSelectedCells(t.getSelection())},onShow:function(){var t=this.getModel(this.getParentEditor());this.setupContent(t)},onOk:function(){for(var t=this._.editor.getSelection(),e=t.createBookmarks(),o=this.getParentEditor(),i=this.getModel(o),n=0;n<i.length;n++)this.commitContent(i[n]);o.forceNextSelectionCheck(),t.selectBookmarks(e),o.selectionChange()},onLoad:function(){var t={};this.foreach((function(e){e.setup&&e.commit&&(e.setup=CKEDITOR.tools.override(e.setup,(function(o){return function(){o.apply(this,arguments),t[e.id]=e.getValue()}})),e.commit=CKEDITOR.tools.override(e.commit,(function(o){return function(){t[e.id]!==e.getValue()&&o.apply(this,arguments)}})))}))}}}));