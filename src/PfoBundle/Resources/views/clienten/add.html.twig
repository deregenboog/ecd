{% extends '::base.html.twig' %}
{% import '::html.macro.twig' as html %}

{% block title %}
    PFO | {{ title }}
{% endblock %}

{% block subnavigation %}
    {% include '@Pfo/subnavigation.html.twig' %}
{% endblock %}

{% block content %}
    <h1>{{ entity_name|capitalize }} toevoegen</h1>
    {{ form_start(form) }}
        <h2>Persoonsgegevens</h2>
        <div class="row">
            <div class="col-xs-6">
                {{ form_row(form.voornaam) }}
                {{ form_row(form.tussenvoegsel) }}
                {{ form_row(form.achternaam) }}
            </div>
            <div class="col-xs-6">
                {{ form_row(form.geslacht) }}
                {{ form_row(form.geboortedatum) }}
            </div>
        </div>
        <h2>Contactgegevens</h2>
        <div class="row">
            <div class="col-xs-6">
                {{ form_row(form.adres) }}
                {{ form_row(form.postcode) }}
                {{ form_row(form.plaats) }}
                {{ form_row(form.telefoon) }}
                {{ form_row(form.mobiel) }}
            </div>
            <div class="col-xs-6">
                {{ form_row(form.email) }}
                {{ form_row(form.notitie) }}
            </div>
        </div>
        <h2>Aanmeldgegevens</h2>
        <div class="row">
            <div class="col-xs-6">
                {{ form_row(form.medewerker) }}
                {{ form_row(form.groep) }}
                {{ form_row(form.aardRelatie) }}
                {{ form_row(form.dubbeleDiagnose) }}
                {{ form_row(form.eerdereHulpverlening) }}
                {{ form_row(form.via) }}
            </div>
            <div class="col-xs-6">
                {{ form_row(form.hulpverleners) }}
                {{ form_row(form.contacten) }}
                {{ form_row(form.begeleidingsformulierOverhandigd) }}
                {{ form_row(form.briefHuisartsVerstuurd) }}
                {{ form_row(form.evaluatieformulierOverhandigd) }}
                {{ form_row(form.afsluitdatum) }}
            </div>
        </div>
        <h2>Koppeling</h2>
        <div class="row">
            <div class="col-xs-6">
                {{ form_row(form.type) }}
                {{ form_row(form.hoofdclient) }}
                {{ form_row(form.gekoppeldeClient) }}
            </div>
            <div class="col-xs-6">
                {{ form_row(form.gekoppeldeClienten) }}
            </div>
        </div>
        <div class="row">
            <div class="col-xs-6">
                {{ form_row(form.submit) }}
            </div>
        </div>
    {{ form_end(form) }}
{% endblock %}

{% block scripts %}
    <script type="text/javascript">
        var onChangeType = function() {
            if ($($('#client_type')).is(':checked')) {
                // show "Gekoppeld aan" and "Gekoppelde clienten"
                $('#client_gekoppeldeClient').closest('.form-group').show();
                $('#client_gekoppeldeClienten').closest('.form-group').show();
                // hide and unselect "Gekoppeld aan"
                $('#client_hoofdclient').closest('.form-group').hide();
                $('#client_hoofdclient').val(null);
            } else {
                // show "Gekoppeld aan"
                $('#client_hoofdclient').closest('.form-group').show();
                // hide and unselect "Client koppelen"
                $('#client_gekoppeldeClient').closest('.form-group').hide();
                $('#client_gekoppeldeClient').val(null);
                // hide and unselect "Gekoppelde clienten"
                $('#client_gekoppeldeClienten').closest('.form-group').hide();
                $('#client_gekoppeldeClienten input').prop('checked', false);
                $('#client_gekoppeldeClienten input').closest('.checkbox').hide();
            }
        };
        var onChangeHoofdclient = function() {
            if ($('#client_hoofdclient').is(':visible')) {
                if ($('#client_hoofdclient').val() === '') {
                    $('#client_type').prop('disabled', false);
                } else {
                    $('#client_type').prop('disabled', true);
                }
            }
        };
        var onChangeGekoppeldeClient = function() {
            $('#client_gekoppeldeClient option:selected').each(function(i, elm) {
                var value = $(elm).attr('value');
                var checkbox = $('#client_gekoppeldeClienten input[value="'+value+'"]');
                checkbox.prop('checked', true);
                $('#client_gekoppeldeClient').val(null);
            });
        };
        var onChangeGekoppeldeClienten = function() {
            $('#client_gekoppeldeClienten input').each(function(i, elm) {
                if ($(elm).is(':checked')) {
                    $(elm).closest('.checkbox').show();
                } else {
                    $(elm).closest('.checkbox').hide();
                }
            });
            if ($('#client_gekoppeldeClienten').is(':visible')) {
                if ($('#client_gekoppeldeClienten input:checked').length > 0) {
                    $('#client_type').prop('disabled', true);
                } else {
                    $('#client_type').prop('disabled', false);
                }
            }
        };
        $(function() {
            onChangeType();
            onChangeHoofdclient();
            onChangeGekoppeldeClienten();
            $('#client_type').change(function() {
                onChangeType();
            });
            $('#client_hoofdclient').change(function() {
                onChangeHoofdclient();
            });
            $('#client_gekoppeldeClient').change(function() {
                onChangeGekoppeldeClient();
                onChangeGekoppeldeClienten();
            });
            $('#client_gekoppeldeClienten').change(function(){
                onChangeGekoppeldeClienten();
            });
        });
    </script>
{% endblock %}
