imports:
    - { resource: daos.yml }
    - { resource: exports.yml }
    - { resource: reports.yml }

parameters:
    inloop.vrijwilligers_locaties:
        vrijwilliger_oud_west: 14
        vrijwilliger_eik: 9
        vrijwilliger_de_kloof: 10
        vrijwilliger_macom: 11
        vrijwilliger_macom_nacht: 12
        vwspreekbuis: 15

services:
    InloopBundle\Service\AccessUpdater:
        public: true
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@InloopBundle\Service\KlantDao'
            - '@InloopBundle\Service\LocatieDao'

    InloopBundle\Event\IntakeSubscriber:
        arguments:
            - '@InloopBundle\Service\KlantDao'
            - "@logger"
            - "@templating"
            - "@mailer"
            - '@InloopBundle\Service\AccessUpdater'
            - "%informele_zorg_mail%"
            - "%dagbesteding_mail%"
            - "%inloophuis_mail%"
            - "%hulpverlening_mail%"
        tags:
            - { name: kernel.event_subscriber }

    InloopBundle\Event\DienstenLookupSubscriber:
        arguments:
            - "@doctrine.orm.entity_manager"
            - "@router"
        tags:
            - { name: kernel.event_subscriber }

    InloopBundle\Event\RegistratieSubscriber:
        arguments:
            - "@doctrine.orm.entity_manager"
        tags:
            - { name: kernel.event_subscriber }

    InloopBundle\Security\IntakeVoter:
        arguments:
            - "@security.access.decision_manager"
        tags:
            - { name: security.voter }

    InloopBundle\Security\RegistratieVoter:
        arguments:
            - "%inloop.vrijwilligers_locaties%"
        tags:
            - { name: security.voter }


    registratie_metadata:
        class: Doctrine\ORM\Mapping\ClassMetadata
        arguments:
            - InloopBundle\Entity\Registratie

    InloopBundle\Repository\RegistratieRepository:
        class: InloopBundle\Repository\RegistratieRepository
        arguments:
            - "@doctrine.orm.entity_manager"
            - "@registratie_metadata"
        calls:
            - method: setSpuitomruilLocaties
              arguments:
                  - '%spuitomruil_locaties%'
        tags:
            - app.doelstelling
        public: true