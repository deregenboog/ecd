imports:
    - { resource: daos.yml }
    - { resource: exports.yml }
    - { resource: reports.yml }

services:
    AppBundle\Security\ControllerAccessVoter:
        arguments:
            - '@security.access.decision_manager'
            - '@request_stack'
        tags:
            - { name: security.voter }

    AppBundle\Security\ControllerVoter:
        arguments:
            - '@security.role_hierarchy'
        tags:
            - { name: security.voter }

    AppBundle\Event\LoadUserEventListener:
        tags:
            - { name: kernel.event_listener, event: ldap_tools_bundle.load_user.after, method: afterUserLoad }

    AppBundle\Event\LoginEventListener:
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@?ldap_tools.security.user.ldap_user_provider'
        tags:
            - { name: kernel.event_listener, event: ldap_tools_bundle.login.success, method: onLoginSuccess }

    twig.extension.routing: # override default routing extension
        class: AppBundle\Twig\RoutingExtension
        public: false
        arguments:
            - '@router'
            - '@request_stack'
        tags:
            - { name: twig.extension }

    app.twig.app_extension:
        class: AppBundle\Twig\AppExtension
        public: false
        arguments:
            - '@request_stack'
            - '%locale%'
            - '%administrator_name%'
            - '%administrator_email%'
            - '%tbc_months_period%'
        tags:
            - { name: twig.extension }

    app.doelstelling:
        class: AppBundle\Form\DoelstellingType
        tags:
            - { name: form.type }

    AppBundle\Form\AddressType:
        arguments: ["@doctrine.orm.entity_manager"]
        tags:
            - { name: form.type }

    AppBundle\Form\KlantType:
        arguments:
          - "@doctrine.orm.entity_manager"
          - $tbc_countries: '%tbc_countries%'
        tags:
            - { name: form.type }

    AppBundle\Form\KlantMergeType:
        arguments: ["@doctrine.orm.entity_manager"]
        tags:
            - { name: form.type }

    AppBundle\Form\MedewerkerFilterType:
        arguments: ["%security.role_hierarchy.roles%"]
        tags:
            - { name: form.type }
    
    AppBundle\Form\VrijwilligerType:
        arguments: ["@doctrine.orm.entity_manager"]
        tags:
            - { name: form.type }

    AppBundle\Form\MedewerkerType:
        arguments: ["@security.token_storage"]
        tags:
            - { name: form.type }

    app.event.kernel_subscriber:
        class: AppBundle\Event\KernelSubscriber
        arguments:
            - '@twig'
        tags:
            - { name: kernel.event_subscriber }

    AppBundle\Event\DienstenLookupSubscriber:
        arguments:
            - '@AppBundle\Service\KlantDao'
        tags:
            - { name: kernel.event_subscriber }

    AppBundle\Controller\DoelstellingenController:
        arguments:
            - !tagged_iterator 'app.doelstelling'

##Register a dao to use in prestaties.
#    AppBundle\Service\KlantDao:
#        arguments:
#            - '@doctrine.orm.default_entity_manager'
#            - '@knp_paginator'
#            - '25'