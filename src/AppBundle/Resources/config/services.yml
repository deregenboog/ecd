imports:
    - { resource: daos.yml }
    - { resource: exports.yml }
    - { resource: reports.yml }

services:
    AppBundle\Event\PreventSaveForDateRangeEventListener:
        arguments:
            - '%prevent_save_enabled%'
            - '%prevent_save_modified_before%'
            - '%prevent_save_modified_after%'
            - '%prevent_save_exclude_entities%'
        tags:
            - { name: doctrine.event_listener, event: preUpdate }
            - { name: doctrine.event_listener, event: prePersist }

    AppBundle\Security\ControllerAccessVoter:
        arguments:
            - '@security.access.decision_manager'
            - '@request_stack'
        tags:
            - { name: security.voter }

    AppBundle\Security\ControllerVoter:
        arguments:
            - '@security.role_hierarchy'
        tags:
            - { name: security.voter }

    AppBundle\Event\LoadUserEventListener:
        tags:
            - { name: kernel.event_listener, event: ldap_tools_bundle.load_user.after, method: afterUserLoad }

    AppBundle\Event\LoginEventListener:
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@?ldap_tools.security.user.ldap_user_provider'
        tags:
            - { name: kernel.event_listener, event: ldap_tools_bundle.login.success, method: onLoginSuccess }
            - { name: kernel.event_listener, event: ldap_tools_bundle.guard.login.failure, method: onLoginFailure }

    twig.extension.routing: # override default routing extension
        class: AppBundle\Twig\RoutingExtension
        public: false
        arguments:
            - '@router'
            - '@request_stack'
        tags:
            - { name: twig.extension }

    app.twig.app_extension:
        class: AppBundle\Twig\AppExtension
        public: false
        arguments:
            - '@request_stack'
            - '%locale%'
            - '%administrator_name%'
            - '%administrator_email%'
            - '%tbc_months_period%'
        tags:
            - { name: twig.extension }

    app.doelstelling:
#    AppBundle\Controller\DoelstellingenController:
        class: AppBundle\Form\DoelstellingType
        arguments:
            - '@security.authorization_checker'
            - '@AppBundle\Service\DoelstellingDao'
        tags:
            - { name: form.type }
        public: true

    voter.doelstelling:
        class: AppBundle\Security\DoelstellingVoter
        arguments:
            - '@security.access.decision_manager'
        tags:
            - { name: security.voter }

    app.downloads:
        class: AppBundle\Service\DownloadsDao
        arguments:
            - "@doctrine.orm.entity_manager"
        public: true

    AppBundle\Form\AddressType:
        arguments: ["@doctrine.orm.entity_manager"]
        tags:
            - { name: form.type }

    AppBundle\Form\KlantType:
        arguments:
          - "@doctrine.orm.entity_manager"
          - $tbc_countries: '%tbc_countries%'
        tags:
            - { name: form.type }

    AppBundle\Form\KlantMergeType:
        arguments: ["@doctrine.orm.entity_manager"]
        tags:
            - { name: form.type }

    AppBundle\Form\MedewerkerFilterType:
        arguments: ["%security.role_hierarchy.roles%"]
        tags:
            - { name: form.type }
    
    AppBundle\Form\VrijwilligerType:
        arguments: ["@doctrine.orm.entity_manager"]
        tags:
            - { name: form.type }

    AppBundle\Form\MedewerkerType:
        arguments: ["@security.token_storage"]
        tags:
            - { name: form.type }


    AppBundle\Form\DownloadVrijwilligersType:
        arguments:
            - ["@doctrine.orm.entity_manager"]
            - !tagged app.downloads
        tags:
            - { name: form.type }

    app.event.kernel_subscriber:
        class: AppBundle\Event\KernelSubscriber
        arguments:
            - '@twig'
        tags:
            - { name: kernel.event_subscriber }

    AppBundle\Event\DienstenLookupSubscriber:
        arguments:
            - '@AppBundle\Service\KlantDao'
        tags:
            - { name: kernel.event_subscriber }

